{%- comment -%} 
  Renders clickable discount chips (25/35/50) and persists the choice in sort/filter forms.
  Only include this on the On-Sale collection page. 
{%- endcomment -%}

{{ 'sale-discount-filter.css' | asset_url | stylesheet_tag }}

{%- liquid
  {%- comment -%} Edit this list if you want more discount banners {%- endcomment -%}
  assign discounts_list = '25,35,50' | split: ','
  assign current_discount = request.params.discount | default: ''
-%}

<div
  class="sale-discount-filter"
  role="group"
  aria-label="Filter by discount">
  <span class="sale-discount-filter__label">Shop by discount:</span>

  {%- for d in discounts_list -%}
    {%- assign is_active = current_discount == d -%}
    <a
      class="sale-chip{% if is_active %} is-active{% endif %}"
      href="{{ collection.url }}?discount={{ d }}"
      aria-pressed="{% if is_active %}true{% else %}false{% endif %}">
      {{ d }}% OFF
    </a>
  {%- endfor -%}

  <a
    class="sale-chip sale-chip--clear{% if current_discount == '' %} is-active{% endif %}"
    href="{{ collection.url }}">
    All
  </a>
</div>

<script>
  /* Keep the chosen ?discount value when the user sorts/filters */
  (function() {
    var params = new URLSearchParams(location.search);
    var d = params.get('discount');
    if (!d) return;
    document.querySelectorAll('form').forEach(function(f){
      if (!f.querySelector('input[name="discount"]')) {
        var i = document.createElement('input');
        i.type = 'hidden';
        i.name = 'discount';
        i.value = d;
        f.appendChild(i);
      }
    });
  })();
</script>
